<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MauiHello.Views.ShopPage"
             Title="RestaurantListPage"
             BackgroundColor="#F5F5F5">
    
    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Add" 
                     Clicked="OnAddRestaurantClicked" 
                     IconImageSource="{FontImage Glyph='+', Color=White, Size=22}" />
    </ContentPage.ToolbarItems>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Restaurant List -->
        <CollectionView Grid.Row="0"
                        ItemsSource="{Binding Restaurants}"
                        BackgroundColor="Transparent"
                        x:Name="restaurantCollectionView"
                        Margin="0,10,0,0">
            
            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="0" />
            </CollectionView.ItemsLayout>
            
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Grid BackgroundColor="White" 
                          Margin="0,0,0,1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="120" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <!-- Restaurant Image -->
                        <Image Grid.Row="0" 
                               Grid.ColumnSpan="2"
                               Source="{Binding ImageUrl}"
                               Aspect="AspectFill"
                               HeightRequest="120" />

                        <!-- Content Area -->
                        <StackLayout Grid.Row="1" 
                                     Grid.Column="0"
                                     Padding="16,12,16,16"
                                     Spacing="4">
                            
                            <!-- Restaurant Name -->
                            <Label Text="{Binding Name}"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="#333333"
                                   LineBreakMode="TailTruncation" />

                            <!-- Tip Percentage -->
                            <Label Text="{Binding TipPctDisplay}"
                                   FontSize="14"
                                   TextColor="#666666" />
                        </StackLayout>

                        <!-- Delete Button Area -->
                        <StackLayout Grid.Row="1" 
                                     Grid.Column="1"
                                     Padding="0,12,16,16"
                                     VerticalOptions="Center">
                            <Button Text="Delete"
                                    BackgroundColor="#FF4444"
                                    TextColor="White"
                                    FontSize="12"
                                    WidthRequest="60"
                                    HeightRequest="32"
                                    CornerRadius="4"
                                    Clicked="OnDeleteRestaurantClicked"
                                    CommandParameter="{Binding .}" />
                        </StackLayout>

                        <!-- Selection Visual Effect -->
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup Name="CommonStates">
                                <VisualState Name="Normal" />
                                <VisualState Name="Selected">
                                    <VisualState.Setters>
                                        <Setter Property="BackgroundColor" Value="#E3F2FD" />
                                    </VisualState.Setters>
                                </VisualState>
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Empty State -->
        <StackLayout Grid.Row="0"
                     IsVisible="{Binding HasNoRestaurants}"
                     VerticalOptions="Center"
                     HorizontalOptions="Center"
                     Padding="40">
            <Label Text="No restaurants found"
                   FontSize="18"
                   TextColor="#999999"
                   HorizontalOptions="Center" />
            <Label Text="Tap the + button to add your first restaurant"
                   FontSize="14"
                   TextColor="#CCCCCC"
                   HorizontalOptions="Center"
                   Margin="0,10,0,0" />
        </StackLayout>
    </Grid>
</ContentPage>